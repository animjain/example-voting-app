pipeline {
    agent any
    
    tools{
        maven "maven 3.6.1"
    }
    
    stages {
        stage("build"){
            steps {
                dir("worker"){
                    sh 'ls -ltr'
                    sh 'mvn compile'
                }
            }
        }
        stage("test"){
            when { changeset '**/worker/**' }
            steps {
                dir("worker"){
                    sh 'mvn clean test'
                }
            }
        }
        stage('package') {
            when { branch 'master' }
            steps {
                dir("worker"){
                   sh 'mvn package -DskipTests'
                   archiveArtifacts artifacts: '**/target/*.jar'
                }
            }
        }
    }
}
